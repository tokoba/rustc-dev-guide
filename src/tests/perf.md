# パフォーマンステスト

## rustc-perf

コンパイラのパフォーマンス向上とパフォーマンス退行の防止に多くの労力が費やされています。

[rustc-perf](https://github.com/rust-lang/rustc-perf) プロジェクトは、パフォーマンスのテストと追跡のためのいくつかのサービスを提供しています。サービスとしてベンチマークを実行するためのホストされたインフラストラクチャを提供しています。現時点では、`x86_64-unknown-linux-gnu` ビルドのみが追跡されています。

「perf run」は、人気のあるクレートの大規模なコレクションに対して、異なる構成でのコンパイラのパフォーマンスを比較するために使用されます。異なる構成には「フレッシュビルド」、インクリメンタルコンパイルを使用したビルドなどが含まれます。

perf run の結果は、2つのバージョンのコンパイラ（それらのコミットハッシュによる）の比較です。

また、`rustc-perf` を使用して、コンパイラを[ローカルで](../profiling/with_rustc_perf.md)手動でベンチマークおよびプロファイリングすることもできます。

### 自動 perf run

すべての PR がマージされた後、コンパイラに対してベンチマークのスイートが実行されます。
結果は <https://perf.rust-lang.org/> ウェブサイトで時系列に追跡されます。
変更があった場合は PR にコメントが付けられます。

### 手動 perf run

さらに、必要に応じて PR がマージされる前にパフォーマンステストを実行できます。PR がパフォーマンスに影響を与える可能性がある場合、特にパフォーマンスに悪影響を与える可能性がある場合は、perf run をリクエストする必要があります。

PR のパフォーマンス影響を評価するには、PR に次のコメントを書いてください：

`@bors try @rust-timer queue`

> **注意**: perf run の実行が許可されているユーザーのみがこのコメントを投稿できます。使用を許可されているチームは、[Teams リポジトリ](https://github.com/rust-lang/team)で `[permissions]` セクションに `perf = true` の値で追跡されています（bors の権限も必要です）。これらのチームのいずれかにいない場合は、誰かに代わりに投稿するよう気軽に依頼してください（Zulip で、または割り当てられたレビュアーに依頼してください）。

これはまず bors に「try」ビルドを行うよう指示し、`x86_64-unknown-linux-gnu` の完全なリリースビルドを行います。ビルドが完了すると、それに対してパフォーマンススイートを実行するキューに配置されます。パフォーマンステストが完了すると、ボットは要約と完全なレポートへのリンクを含むコメントを PR に投稿します。

既にビルドされたアーティファクトに対して perf run を実行したい場合（例えば、まだベンチマークされていない以前の try ビルドに対して）、代わりに次を実行できます：

`@rust-timer build <commit-sha>`

ただし、同じアーティファクトを2回ベンチマークすることはできません。

利用可能な perf bot コマンドの詳細については、[こちら](https://perf.rust-lang.org/help.html)をご覧ください。

ベンチマークプロセス自体の詳細については、[perf collector ドキュメント](https://github.com/rust-lang/rustc-perf/blob/master/collector/README.md)で入手できます。
